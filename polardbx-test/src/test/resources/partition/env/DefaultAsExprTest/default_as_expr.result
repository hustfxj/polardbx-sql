## DISABLE_FAST_SQL_PARSER
#echo #
#echo # Test SHOW CREATE TABLE, DESCRIBE TABLE and CREATE as SELECT
#echo #
CREATE TABLE t1 (id char(36) DEFAULT (uuid()));
CREATE TABLE t3 LIKE t1;
SHOW CREATE TABLE t3;
Table,Create Table
t3,CREATE TABLE `t3` (
	`id` char(36) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT (uuid())
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 DEFAULT COLLATE = utf8mb4_general_ci
SINGLE
# select just length as results are different for each run
SELECT LENGTH(id) FROM t1;
LENGTH(id)
SHOW CREATE TABLE t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`id` char(36) COLLATE utf8mb4_general_ci DEFAULT (uuid())
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 DEFAULT COLLATE = utf8mb4_general_ci
SINGLE
SHOW COLUMNS FROM t1;
Field,Type,Null,Key,Default,Extra
id,char(36),YES,,uuid(),DEFAULT_GENERATED
DESCRIBE t1;
Field,Type,Null,Key,Default,Extra
id,char(36),YES,,uuid(),DEFAULT_GENERATED
DROP TABLE t1;
DROP TABLE t3;
#echo #
#echo # Test UTF8
#echo #
CREATE TABLE `t1` (i varchar(200) DEFAULT (_utf8mb4'\U+1F9DB♀'));
INSERT INTO t1 values (default),(default);
SELECT * from t1;
i
U+1F9DB♀
U+1F9DB♀
DESCRIBE t1;
Field,Type,Null,Key,Default,Extra
i,varchar(200),YES,,_utf8mb4\'U+1F9DBâ\',DEFAULT_GENERATED
DROP TABLE t1;
CREATE TABLE `t1` (i varchar(200) DEFAULT (_utf8mb4"\U+1F9DB♀"));
INSERT INTO t1 values (default),(default);
SELECT * from t1;
i
U+1F9DB♀
U+1F9DB♀
DESCRIBE t1;
Field,Type,Null,Key,Default,Extra
i,varchar(200),YES,,_utf8mb4\'U+1F9DBâ\',DEFAULT_GENERATED
DROP TABLE t1;
#echo #
#echo # Test with TIMESTAMP with and without ON UPDATE
#echo #
CREATE TABLE t1 (a INT, b TIMESTAMP NOT NULL DEFAULT (TIMESTAMPADD(MINUTE, 1,'2003-01-02')));
SHOW CREATE TABLE t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`b` timestamp NOT NULL DEFAULT (_utf8mb4 '2003-01-02' + INTERVAL 1 MINUTE)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 DEFAULT COLLATE = utf8mb4_general_ci
SINGLE
insert into t1(a) values (1);
DROP TABLE t1;
CREATE TABLE t1 (a INT, c TIMESTAMP DEFAULT (TIMESTAMPADD(MINUTE, 5,'2003-01-02')));
SHOW CREATE TABLE t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`c` timestamp NOT NULL DEFAULT (_utf8mb4 '2003-01-02' + INTERVAL 5 MINUTE)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4 DEFAULT COLLATE = utf8mb4_general_ci
SINGLE
INSERT INTO t1(a) VALUES (5),(6);
ALTER TABLE t1 ADD COLUMN d TIMESTAMP DEFAULT (TIMESTAMPADD(MINUTE, 10,'2003-01-03')) ON UPDATE CURRENT_TIMESTAMP;
SHOW CREATE TABLE t1;
Table,Create Table
t1,CREATE TABLE `t1` (
	`a` int(11) DEFAULT NULL,
	`c` timestamp NOT NULL DEFAULT (_utf8mb4 '2003-01-02' + INTERVAL 5 MINUTE),
	`d` timestamp NOT NULL DEFAULT (_utf8mb4 '2003-01-03' + INTERVAL 10 MINUTE) ON UPDATE CURRENT_TIMESTAMP
) ENGINE = InnoDB AUTO_INCREMENT = 100003 DEFAULT CHARSET = utf8mb4 DEFAULT COLLATE = utf8mb4_general_ci
SINGLE
UPDATE t1 SET a = 10 WHERE a = 5;
ALTER TABLE t1 DROP COLUMN d;
ALTER TABLE t1 ADD COLUMN d TIMESTAMP DEFAULT (TIMESTAMPADD(MINUTE, 15,'2003-01-04'));
SELECT * from t1;
a,c,d
10,2003-01-02 00:05:00.0,2003-01-04 00:15:00.0
6,2003-01-02 00:05:00.0,2003-01-04 00:15:00.0
DROP TABLE t1;
#echo # Function that are now allowed.
#echo # result is not shown as the data is non-deterministic
CREATE TABLE t1 (b double DEFAULT (rand()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(b) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (curdate()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (current_date()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (current_date));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (current_time()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (current_time));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (current_timestamp()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (current_timestamp));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (localtime()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (localtime));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime DEFAULT (curtime()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b varchar(20) DEFAULT (localtimestamp()));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b varchar(20) DEFAULT (localtimestamp));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b varchar(20) DEFAULT (now()));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (b varchar(100) DEFAULT (sysdate()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(b) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b INT DEFAULT (unix_timestamp()));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b datetime DEFAULT (utc_date()));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b datetime DEFAULT (utc_time()));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a datetime, b datetime DEFAULT (utc_timestamp()));
INSERT INTO t1(a) VALUES (now());
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (now());
INSERT INTO t1 VALUES (now(), DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES (now(), DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a int DEFAULT (connection_id()));
INSERT INTO t1 VALUES (DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES (DEFAULT);
DROP TABLE t1;
CREATE TABLE t1 (a varchar(1024), b varchar(1024) DEFAULT (database()));
INSERT INTO t1(a) VALUES ("");
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1(a) VALUES ("");
INSERT INTO t1 VALUES ("", DEFAULT);
/*+TDDL: DML_EXECUTION_STRATEGY=LOGICAL*/ INSERT INTO t1 VALUES ("", DEFAULT);
DROP TABLE t1;