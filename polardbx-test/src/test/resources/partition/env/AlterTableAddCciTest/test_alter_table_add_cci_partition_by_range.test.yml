#clean
DROP TABLE IF EXISTS t_order_0;

CREATE TABLE `t_order_0` (
	`id` bigint(11) NOT NULL AUTO_INCREMENT,
	`order_id` varchar(20) DEFAULT NULL,
	`buyer_id` varchar(20) DEFAULT NULL,
	`seller_id` varchar(20) DEFAULT NULL,
	`order_snapshot` longtext,
	`order_detail` longtext,
	`order_datetime` datetime DEFAULT NULL,
	`country` varchar(64) DEFAULT NULL,
	`city` varchar(64) DEFAULT NULL,
	`gmt_modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
	`rint` double(10, 2),
	PRIMARY KEY (`id`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8;


# alter table add cci cci_0(seller_id) PARTITION BY RANGE COLUMNS (`order_id`, `order_datetime`) (
#		PARTITION p1 VALUES LESS THAN (10000, '2021-01-01'),
#		PARTITION p2 VALUES LESS THAN (20000, '2021-01-01'),
#		PARTITION p3 VALUES LESS THAN (30000, '2021-01-01'),
#		PARTITION p4 VALUES LESS THAN (40000, '2021-01-01'),
#		PARTITION p5 VALUES LESS THAN (50000, '2021-01-01'),
#		PARTITION p6 VALUES LESS THAN (MAXVALUE, MAXVALUE)
#	) on auto partition table t_order_0
/*+TDDL:CMD_EXTRA(SKIP_DDL_TASKS="WaitColumnarTableCreationTask")*/ALTER TABLE `t_order_0` ADD CLUSTERED COLUMNAR INDEX cci_0 (`seller_id`) PARTITION BY RANGE COLUMNS (`order_id`, `order_datetime`) (
		PARTITION p1 VALUES LESS THAN (10000, '2021-01-01'),
		PARTITION p2 VALUES LESS THAN (20000, '2021-01-01'),
		PARTITION p3 VALUES LESS THAN (30000, '2021-01-01'),
		PARTITION p4 VALUES LESS THAN (40000, '2021-01-01'),
		PARTITION p5 VALUES LESS THAN (50000, '2021-01-01'),
		PARTITION p6 VALUES LESS THAN (MAXVALUE, MAXVALUE)
	);
/*+TDDL:CMD_EXTRA(ALTER_CCI_STATUS=true, ALTER_CCI_STATUS_BEFORE=CREATING, ALTER_CCI_STATUS_AFTER=PUBLIC)*/ALTER TABLE `t_order_0`
	 ALTER INDEX `cci_0` VISIBLE ;
SHOW FULL CREATE TABLE t_order_0;
CHECK COLUMNAR INDEX `cci_0` ON `t_order_0` META;
DROP INDEX `cci_0` ON `t_order_0`;

# alter table add cci cci_1(seller_id) PARTITION BY RANGE (to_days(`order_datetime`)) (
#		PARTITION p1 VALUES LESS THAN (to_days('2021-01-01')),
#		PARTITION p2 VALUES LESS THAN (to_days('2021-04-01')),
#		PARTITION p3 VALUES LESS THAN (to_days('2021-07-01')),
#		PARTITION p4 VALUES LESS THAN (to_days('2021-10-01')),
#		PARTITION p5 VALUES LESS THAN (to_days('2022-01-01')),
#		PARTITION p6 VALUES LESS THAN MAXVALUE
#	) on auto partition table t_order_0
/*+TDDL:CMD_EXTRA(SKIP_DDL_TASKS="WaitColumnarTableCreationTask")*/ALTER TABLE `t_order_0` ADD CLUSTERED COLUMNAR INDEX cci_1 (`seller_id`) PARTITION BY RANGE (to_days(`order_datetime`)) (
		PARTITION p1 VALUES LESS THAN (to_days('2021-01-01')),
		PARTITION p2 VALUES LESS THAN (to_days('2021-04-01')),
		PARTITION p3 VALUES LESS THAN (to_days('2021-07-01')),
		PARTITION p4 VALUES LESS THAN (to_days('2021-10-01')),
		PARTITION p5 VALUES LESS THAN (to_days('2022-01-01')),
		PARTITION p6 VALUES LESS THAN MAXVALUE
	);
/*+TDDL:CMD_EXTRA(ALTER_CCI_STATUS=true, ALTER_CCI_STATUS_BEFORE=CREATING, ALTER_CCI_STATUS_AFTER=PUBLIC)*/ALTER TABLE `t_order_0`
	 ALTER INDEX `cci_1` VISIBLE ;
SHOW FULL CREATE TABLE t_order_0;
CHECK COLUMNAR INDEX `cci_1` ON `t_order_0` META;
DROP INDEX `cci_1` ON `t_order_0`;

#cleanup
DROP TABLE IF EXISTS t_order_0;
