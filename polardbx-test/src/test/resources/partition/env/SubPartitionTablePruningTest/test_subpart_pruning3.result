## DISABLE_FAST_SQL_PARSER
CREATE TABLE `sp_range_range_n` (
`id` int(11) NOT NULL,
`age` int(11) DEFAULT NULL,
`name` char(32) DEFAULT NULL,
`ctime` datetime DEFAULT NULL,
`remark` varchar(32) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `auto_shard_key_ctime` USING BTREE (`ctime`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(YEAR(`ctime`))
SUBPARTITION BY RANGE(`id`)
(PARTITION p1 VALUES LESS THAN (2011)
(SUBPARTITION p1sp1 VALUES LESS THAN (1000) ENGINE = InnoDB),
PARTITION p2 VALUES LESS THAN (2012)
(SUBPARTITION p2sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
SUBPARTITION p2sp2 VALUES LESS THAN (2000) ENGINE = InnoDB),
PARTITION p3 VALUES LESS THAN (2013)
(SUBPARTITION p3sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
SUBPARTITION p3sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
SUBPARTITION p3sp3 VALUES LESS THAN (3000) ENGINE = InnoDB),
PARTITION p4 VALUES LESS THAN (2014)
(SUBPARTITION p4sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
SUBPARTITION p4sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
SUBPARTITION p4sp3 VALUES LESS THAN (3000) ENGINE = InnoDB,
SUBPARTITION p4sp4 VALUES LESS THAN (4000) ENGINE = InnoDB),
PARTITION p5 VALUES LESS THAN (2015)
(SUBPARTITION p5sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
SUBPARTITION p5sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
SUBPARTITION p5sp3 VALUES LESS THAN (3000) ENGINE = InnoDB,
SUBPARTITION p5sp4 VALUES LESS THAN (4000) ENGINE = InnoDB,
SUBPARTITION p5sp5 VALUES LESS THAN (5000) ENGINE = InnoDB));
show create table sp_range_range_n;
Table,Create Table
sp_range_range_n,CREATE TABLE `sp_range_range_n` (
	`id` int(11) NOT NULL,
	`age` int(11) DEFAULT NULL,
	`name` char(32) DEFAULT NULL,
	`ctime` datetime DEFAULT NULL,
	`remark` varchar(32) DEFAULT NULL,
	PRIMARY KEY (`id`),
	KEY `auto_shard_key_ctime` USING BTREE (`ctime`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(YEAR(`ctime`))
SUBPARTITION BY RANGE(`id`)
(PARTITION p1 VALUES LESS THAN (2011)
 (SUBPARTITION p1sp1 VALUES LESS THAN (1000) ENGINE = InnoDB),
 PARTITION p2 VALUES LESS THAN (2012)
 (SUBPARTITION p2sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
  SUBPARTITION p2sp2 VALUES LESS THAN (2000) ENGINE = InnoDB),
 PARTITION p3 VALUES LESS THAN (2013)
 (SUBPARTITION p3sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
  SUBPARTITION p3sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
  SUBPARTITION p3sp3 VALUES LESS THAN (3000) ENGINE = InnoDB),
 PARTITION p4 VALUES LESS THAN (2014)
 (SUBPARTITION p4sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
  SUBPARTITION p4sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
  SUBPARTITION p4sp3 VALUES LESS THAN (3000) ENGINE = InnoDB,
  SUBPARTITION p4sp4 VALUES LESS THAN (4000) ENGINE = InnoDB),
 PARTITION p5 VALUES LESS THAN (2015)
 (SUBPARTITION p5sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
  SUBPARTITION p5sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
  SUBPARTITION p5sp3 VALUES LESS THAN (3000) ENGINE = InnoDB,
  SUBPARTITION p5sp4 VALUES LESS THAN (4000) ENGINE = InnoDB,
  SUBPARTITION p5sp5 VALUES LESS THAN (5000) ENGINE = InnoDB))
explain DELETE FROM `sp_range_range_n` WHERE (`id`='2499' AND `ctime`='2013-01-01 00:00:00') or (`id`='2799' AND `ctime`='2014-01-01 00:00:00') or (`id`='1799' AND `ctime`='2014-01-01 00:00:00');
Logical ExecutionPlan
LogicalModifyView(tables="sp_range_range_n[p4sp2,p4sp3,p5sp2,p5sp3]", shardCount=4, sql="DELETE FROM `sp_range_range_n` WHERE (((`id` = ?) AND (`ctime` = ?)) OR ((`id` = ?) AND (`ctime` = ?)) OR ((`id` = ?) AND (`ctime` = ?)))")
DELETE FROM `sp_range_range_n` WHERE (`id`='2499' AND `ctime`='2013-01-01 00:00:00') or (`id`='2799' AND `ctime`='2014-01-01 00:00:00') or (`id`='1799' AND `ctime`='2014-01-01 00:00:00');
CREATE TABLE `sp_range_range_n2` (
`id` int(11) NOT NULL,
`age` int(11) DEFAULT NULL,
`name` char(32) DEFAULT NULL,
`ctime` datetime DEFAULT NULL,
`remark` varchar(32) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `auto_shard_key_ctime` USING BTREE (`ctime`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(YEAR(`ctime`))
SUBPARTITION BY RANGE(`id`)
(
PARTITION p1 VALUES LESS THAN (2011)
(SUBPARTITION p1sp1 VALUES LESS THAN (1000) ENGINE = InnoDB),
PARTITION p2 VALUES LESS THAN (2012)
(SUBPARTITION p2sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
SUBPARTITION p2sp2 VALUES LESS THAN (2000) ENGINE = InnoDB),
PARTITION p3 VALUES LESS THAN (2013)
(SUBPARTITION p3sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
SUBPARTITION p3sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
SUBPARTITION p3sp3 VALUES LESS THAN (3000) ENGINE = InnoDB)
);
show create table sp_range_range_n2;
Table,Create Table
sp_range_range_n2,CREATE TABLE `sp_range_range_n2` (
	`id` int(11) NOT NULL,
	`age` int(11) DEFAULT NULL,
	`name` char(32) DEFAULT NULL,
	`ctime` datetime DEFAULT NULL,
	`remark` varchar(32) DEFAULT NULL,
	PRIMARY KEY (`id`),
	KEY `auto_shard_key_ctime` USING BTREE (`ctime`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(YEAR(`ctime`))
SUBPARTITION BY RANGE(`id`)
(PARTITION p1 VALUES LESS THAN (2011)
 (SUBPARTITION p1sp1 VALUES LESS THAN (1000) ENGINE = InnoDB),
 PARTITION p2 VALUES LESS THAN (2012)
 (SUBPARTITION p2sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
  SUBPARTITION p2sp2 VALUES LESS THAN (2000) ENGINE = InnoDB),
 PARTITION p3 VALUES LESS THAN (2013)
 (SUBPARTITION p3sp1 VALUES LESS THAN (1000) ENGINE = InnoDB,
  SUBPARTITION p3sp2 VALUES LESS THAN (2000) ENGINE = InnoDB,
  SUBPARTITION p3sp3 VALUES LESS THAN (3000) ENGINE = InnoDB))
explain DELETE FROM `sp_range_range_n2`
  WHERE ctime >= '2011-01-01 00:00:00' and ctime <= '2011-01-01 00:00:00'
  and ( id=1799 or id=2499 or id=2799 );
Logical ExecutionPlan
LogicalModifyView(tables="sp_range_range_n2[p2sp2]", sql="DELETE FROM `sp_range_range_n2` WHERE ((`id` IN(?, ?, ?)) AND (`ctime` >= ?) AND (`ctime` <= ?))")
DELETE FROM `sp_range_range_n2`
WHERE ctime >= '2011-01-01 00:00:00' and ctime <= '2011-01-01 00:00:00'
and ( id=1799 or id=2499 or id=2799 );
CREATE TABLE `sp_range_range_n3` (
`id` int(11) NOT NULL,
`age` int(11) DEFAULT NULL,
`name` char(32) DEFAULT NULL,
`ctime` datetime DEFAULT NULL,
`remark` varchar(32) DEFAULT NULL,
PRIMARY KEY (`id`),
KEY `auto_shard_key_ctime` USING BTREE (`ctime`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(id)
SUBPARTITION BY RANGE(YEAR(ctime))
(
PARTITION p1 VALUES LESS THAN (1000)
(SUBPARTITION p1sp1 VALUES LESS THAN (2011) ENGINE = InnoDB),
PARTITION p2 VALUES LESS THAN (2000)
(SUBPARTITION p2sp1 VALUES LESS THAN (2011) ENGINE = InnoDB,
SUBPARTITION p2sp2 VALUES LESS THAN (2012) ENGINE = InnoDB),
PARTITION p3 VALUES LESS THAN (3000)
(SUBPARTITION p3sp1 VALUES LESS THAN (2011) ENGINE = InnoDB,
SUBPARTITION p3sp2 VALUES LESS THAN (2012) ENGINE = InnoDB,
SUBPARTITION p3sp3 VALUES LESS THAN (2013) ENGINE = InnoDB)
);
show create table sp_range_range_n3;
Table,Create Table
sp_range_range_n3,CREATE TABLE `sp_range_range_n3` (
	`id` int(11) NOT NULL,
	`age` int(11) DEFAULT NULL,
	`name` char(32) DEFAULT NULL,
	`ctime` datetime DEFAULT NULL,
	`remark` varchar(32) DEFAULT NULL,
	PRIMARY KEY (`id`),
	KEY `auto_shard_key_ctime` USING BTREE (`ctime`)
) ENGINE = InnoDB DEFAULT CHARSET = utf8mb4
PARTITION BY RANGE(`id`)
SUBPARTITION BY RANGE(YEAR(`ctime`))
(PARTITION p1 VALUES LESS THAN (1000)
 (SUBPARTITION p1sp1 VALUES LESS THAN (2011) ENGINE = InnoDB),
 PARTITION p2 VALUES LESS THAN (2000)
 (SUBPARTITION p2sp1 VALUES LESS THAN (2011) ENGINE = InnoDB,
  SUBPARTITION p2sp2 VALUES LESS THAN (2012) ENGINE = InnoDB),
 PARTITION p3 VALUES LESS THAN (3000)
 (SUBPARTITION p3sp1 VALUES LESS THAN (2011) ENGINE = InnoDB,
  SUBPARTITION p3sp2 VALUES LESS THAN (2012) ENGINE = InnoDB,
  SUBPARTITION p3sp3 VALUES LESS THAN (2013) ENGINE = InnoDB))
explain DELETE FROM `sp_range_range_n3`
WHERE ctime >= '2011-01-01 00:00:00' and ctime <= '2011-01-01 00:00:00'
and ( id=1799 or id=2499 or id=2799 );
Logical ExecutionPlan
LogicalModifyView(tables="sp_range_range_n3[p2sp2,p3sp2]", shardCount=2, sql="DELETE FROM `sp_range_range_n3` WHERE ((`id` IN(?, ?, ?)) AND (`ctime` >= ?) AND (`ctime` <= ?))")
DELETE FROM `sp_range_range_n3`
WHERE ctime >= '2011-01-01 00:00:00' and ctime <= '2011-01-01 00:00:00'
and ( id=1799 or id=2499 or id=2799 );